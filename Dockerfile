FROM ubuntu:20.04

RUN echo "#!/bin/sh\nexit 0" > /usr/sbin/policy-rc.d

RUN apt-get update -y && \
    apt-get install -y python3 python3-pip  && \
    apt-get install -y cron

WORKDIR /cvesearch
COPY . .
COPY Docker/configuration.ini etc
COPY Docker/cvesearch.cron /etc/cron.d/cvesearch.cron

# Install python modules
RUN pip3 install -r requirements.txt

# Apply cron job
RUN crontab /etc/cron.d/cvesearch.cron

# Create the log file for cron job
RUN touch /var/log/cvesearch.cron.log

# Start the service. Also starts cron
CMD sh Docker/start.sh
